!function(e){function t(t){for(var n,c,s=t[0],i=t[1],u=t[2],d=0,p=[];d<s.length;d++)c=s[d],Object.prototype.hasOwnProperty.call(o,c)&&o[c]&&p.push(o[c][0]),o[c]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,s=1;s<r.length;s++){var i=r[s];0!==o[i]&&(n=!1)}n&&(a.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},o={0:0},a=[];function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var s=window.webpackJsonp=window.webpackJsonp||[],i=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=i;a.push([658,1]),r()}({150:function(e,t,r){var n=r(425),o=[];e.exports=function(){var e=new Worker(r.p+"b33b16778fd173eed467.worker.js",{name:"[hash].worker.js"});return n(e,o),e}},159:function(e,t){},319:function(e,t){},331:function(e,t){},333:function(e,t){},345:function(e,t){},346:function(e,t){},370:function(e,t){},372:function(e,t){},381:function(e,t){},383:function(e,t){},404:function(e,t){},406:function(e,t){},413:function(e,t){},415:function(e,t){},418:function(e,t){},420:function(e,t){},422:function(e,t){},487:function(e,t){},489:function(e,t){},571:function(e,t){},573:function(e,t){},580:function(e,t){},581:function(e,t){},658:function(e,t,r){"use strict";r.r(t);var n=r(13),o=r.n(n),a=r(6),c=r.n(a),s=r(29),i=r.n(s),u=r(18),l=r.n(u),d=r(14),p=r.n(d),f=r(33),h=r.n(f),v=r(37),g=r.n(v),y=r(25),k=r.n(y),w=r(7),m=r.n(w),b=r(287),S=r.n(b),x=r(20),P=r(55),O=("\n\t(function () {\n\t\t".concat("\n\tconst shortcutIcon = window.document.querySelector('head > link[rel=\"shortcut icon\"]');\n\tconst icon = shortcutIcon || Array.from(window.document.querySelectorAll('head > link[rel=\"icon\"]')).find((icon) => Boolean(icon.href));\n\n\tconst siteName = document.querySelector('head > meta[property=\"og:site_name\"]');\n\tconst title = siteName || document.querySelector('head > meta[name=\"title\"]');\n\twindow.ReactNativeWebView && window.ReactNativeWebView.postMessage(JSON.stringify(\n\t\t{\n\t\t\ttype: 'GET_TITLE_FOR_BOOKMARK',\n\t\t\tpayload: {\n\t\t\t\ttitle: title ? title.content : document.title,\n\t\t\t\turl: location.href,\n\t\t\t\ticon: icon && icon.href\n\t\t\t}\n\t\t}\n\t))\n","\n\t})();\n"),"\n\t(function () {\n\t\t".concat('\n\tconst __getFavicon = function(){\n\t\tlet favicon = undefined;\n\t\tconst nodeList = document.getElementsByTagName("link");\n\t\tfor (let i = 0; i < nodeList.length; i++)\n\t\t{\n\t\t\tconst rel = nodeList[i].getAttribute("rel")\n\t\t\tif (rel === "icon" || rel === "shortcut icon")\n\t\t\t{\n\t\t\t\tfavicon = nodeList[i]\n\t\t\t}\n\t\t}\n\t\treturn favicon && favicon.href\n\t}\n\twindow.ReactNativeWebView && window.ReactNativeWebView.postMessage(JSON.stringify(\n\t\t{\n\t\t\ttype: \'GET_WEBVIEW_URL\',\n\t\t\tpayload: {\n\t\t\t\turl: location.href,\n\t\t\t\ticon: __getFavicon()\n\t\t\t}\n\t\t}\n\t))\n',"\n\t})();\n"),r(3)),E=r(288);function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=k()(e);if(t){var o=k()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return g()(this,r)}}var _=function(){},R=function(e){h()(r,e);var t=T(r);function r(e,n){var o;return l()(this,r),console.log("PortDuplexStream constructor"),o=t.call(this,{objectMode:!0}),m()(p()(o),"_onMessage",(function(e){if(console.log("PortDuplexStream _onMessage"),console.log(e),O.Buffer.isBuffer(e)){delete e._isBuffer;var t=new O.Buffer(e);this.push(t)}else this.push(e)})),m()(p()(o),"_onDisconnect",(function(){console.log("PortDuplexStream _onDisconnect"),this.destroy&&this.destroy()})),m()(p()(o),"_read",_),m()(p()(o),"_write",(function(e,t,r){console.log("MobilePortStream _write"),console.log(e),console.log(this._port);try{if(O.Buffer.isBuffer(e)){var n=e.toJSON();n._isBuffer=!0,this._port.postMessage(n,this._url)}else this._port.postMessage(e,this._url)}catch(e){return console.error(e),r(new Error("PortDuplexStream - disconnected"))}r()})),o._port=e,o._url=n,o._port.addListener("message",o._onMessage.bind(p()(o))),o._port.addListener("disconnect",o._onDisconnect.bind(p()(o))),console.log("PortDuplexStream constructor end"),o}return r}(E.Duplex),j=(r(402),r(411)),C=r(202);var M=r(289);var A=r(150),I=r.n(A);console.log("mpc worker class"),console.log(I.a);var K=function(){function e(t){var r=this;l()(this,e),m()(this,"worker",void 0),m()(this,"kgEE",void 0),m()(this,"sgEE",void 0),m()(this,"selfSignEE",void 0),m()(this,"showMnemonicEE",void 0),m()(this,"recoverEE",void 0),m()(this,"recoverSIDEE",void 0),m()(this,"sendCipherEE",void 0),m()(this,"emRecoverEE",void 0),this.worker=new I.a,this.worker.onmessage=function(e){console.log("uc-wasm onmessage"),console.log(e),"wasm:loaded"===e.data.eventType&&t.emit("wasm:loaded",{}),"kg"===e.data.eventType&&e.data.done&&r.kgEE.emit("end",e.data.result),"sg"===e.data.eventType&&e.data.done&&r.sgEE.emit("end",e.data.result),"self-sign"===e.data.eventType&&e.data.done&&r.selfSignEE.emit("end",e.data.result),"show-mnemonic"===e.data.eventType&&e.data.done&&r.showMnemonicEE.emit("end",e.data.result),"recover"===e.data.eventType&&e.data.done&&r.recoverEE.emit("end",e.data.result),"recover-sid"===e.data.eventType&&e.data.done&&r.recoverSIDEE.emit("end",e.data.result),"send-cipher"===e.data.eventType&&r.sendCipherEE.emit("end",e.data.result),"em-recover"===e.data.eventType&&r.emRecoverEE.emit("end",e.data.result),"unlock"===e.data.eventType&&r.emRecoverEE.emit("end",e.data.result),"addAccount"===e.data.eventType&&r.emRecoverEE.emit("end",e.data.result),"changeActiveAccount"===e.data.eventType&&r.emRecoverEE.emit("end",e.data.result),"checkPassword"===e.data.eventType&&r.emRecoverEE.emit("end",e.data.result)},this.worker.postMessage({eventType:"init",data:"go-wasm"})}return i()(e,[{key:"terminate",value:function(){try{this.worker.terminate()}catch(e){}}},{key:"generateKeyShare",value:function(e,t){try{console.log("uc-wasm generateKeyShare"),this.kgEE=t,this.worker.postMessage({eventType:"kg",dto:e})}catch(e){console.error(e)}}},{key:"sign",value:function(e,t){this.sgEE=t,this.worker.postMessage({eventType:"sg",arg:e})}},{key:"selfSign",value:function(e,t){this.selfSignEE=t;e.password,e.EncPV,e.hashMessage;this.worker.postMessage({eventType:"self-sign",arg:e})}},{key:"showMnemonic",value:function(e,t){this.showMnemonicEE=t,this.worker.postMessage({eventType:"show-mnemonic"})}},{key:"recoverShare",value:function(e,t){this.recoverEE=t,this.worker.postMessage({eventType:"recover",dto:e})}},{key:"recoverSID",value:function(e,t){this.recoverSIDEE=t,this.worker.postMessage({eventType:"recover-sid",dto:e})}},{key:"sendCipher",value:function(e,t){this.sendCipherEE=t,this.worker.postMessage({eventType:"send-cipher",dto:e})}},{key:"emRecover",value:function(e,t){this.emRecoverEE=t,this.worker.postMessage({eventType:"em-recover",dto:e})}},{key:"addAccount",value:function(e,t){this.emRecoverEE=t,this.worker.postMessage({eventType:"addAccount",dto:e})}},{key:"changeActiveAccount",value:function(e,t){this.emRecoverEE=t,this.worker.postMessage({eventType:"changeActiveAccount",dto:e})}},{key:"unlock",value:function(e,t){this.emRecoverEE=t,this.worker.postMessage({eventType:"unlock",dto:e})}},{key:"checkPassword",value:function(e,t){this.emRecoverEE=t,this.worker.postMessage({eventType:"checkPassword",dto:e})}}]),e}();function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=k()(e);if(t){var o=k()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return g()(this,r)}}console.log("start bridge.js");var D=r(209),N=r(433),F=r(202),G=r(15).EventEmitter,V=function(e){h()(r,e);var t=U(r);function r(e,n){var o;return l()(this,r),o=t.call(this),m()(p()(o),"postMessage",(function(e){console.log("POrt postMessage"),console.log(e),window.parent.postMessage(JSON.stringify(e),"*")})),o._window=e,o._isMainFrame=n,o}return r}(G);var J=function(e){h()(r,e);var t=U(r);function r(e){var n,o=e.webview,a=e.url,c=e.getRpcMethodMiddleware,s=e.isMainFrame,i=e.transactionController,u=e.accountController,d=e.providerConnectionManager,f=e.dekeyStore;l()(this,r),console.log("BackgroundBridge constructor"),console.log(a),n=t.call(this),m()(p()(n),"sendStateUpdate",(function(){console.log("sendStateUpdate"),n.emit("update")})),m()(p()(n),"onMessage",(function(e){console.log("onMessage"),console.log(e),n.port.emit("message",{name:e.name,data:e.data})})),m()(p()(n),"onDisconnect",(function(){console.log("onDisconnect"),n.port.emit("disconnect",{name:n.port.name,data:null})})),n.url=a,n.hostname=new S.a(a).hostname,n.isMainFrame=s,n._webviewRef=o,n.createMiddleware=c,n.transactionController=i,n.accountController=u,n.providerConnectionManager=d,n.dekeyStore=f,n.port=new V(n._webviewRef,s),console.log("BackgroundBridge port"),console.log(n.port),n.engine=null,n.chainIdSent=null;var h=function(e){var t=new j;return C(e,t,e,(function(e){e&&console.warn(e)})),t}(new R(n.port,a));n.setupProviderConnection(h.createStream("metamask-provider")),n.on("update",n.onStateUpdate),console.log("after BackgroundBridge constuctor"),console.log("after require dekey-mobile-provider"),window.test="HAHA",window.addEventListener("message",(function(e){console.log(e);var t=e.data;try{t=JSON.parse(e.data)}catch(e){}n.onMessage(t)}));var v=n.dekeyStore.getState().user,g=v&&v.share&&v.share.EncPV;return window.parent.postMessage({type:"bridge#initialized",hasKeyShare:g},"*"),n}return i()(r,[{key:"onStateUpdate",value:function(e){console.log("onStateUpdate"),e||(e=this.getState());var t=this.getProviderNetworkState(e);this.chainIdSent!==t.chainId&&(this.chainIdSent=t.chainId)}},{key:"getProviderState",value:function(){console.log("getProviderState");var e=this.getState();return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({isUnlocked:this.isUnlocked()},this.getProviderNetworkState(e))}},{key:"setupProviderConnection",value:function(e){var t=this;try{console.log("setupProviderConnection"),console.log(e),this.engine=this.setupProviderEngine(),console.log("setupProviderEngine"),console.log(this.engine);var r=Object(M.createEngineStream)({engine:this.engine});console.log("providerStream"),console.log(r),F(e,r,e,(function(e){console.log("bridge setupProviderConnection pump error"),console.error(e),t.engine._middleware.forEach((function(e){e.destroy&&"function"==typeof e.destroy&&e.destroy()}))}))}catch(e){console.error(e)}}},{key:"setupProviderEngine",value:function(){var e,t=new x.JsonRpcEngine,r=this.providerConnectionManager.getProviderAndBlockTracker(),n=r.provider,a=r.blockTracker,s=D({provider:n,blockTracker:a}),i=N({provider:n,blockTracker:a});return i.events.on("notification",(function(e){return t.emit("notification",e)})),t.push((e={origin:origin},function(t,r,n){console.log("RPC (".concat(e.origin,"):"),t,"->",r),n((function(n){console.log("RPC (".concat(e.origin,"):"),t,"->",r),n()}))})),t.push(s),t.push(i.middleware),t.push(function(e){e.hostname,e.getProviderState;var t=e.ethSendTransaction,r=e.resetStore,n=e.getStoreState,a=e.dekeyGenerateKey,s=e.retrieveKeyShare,i=e.unlock;return Object(x.createAsyncMiddleware)(function(){var e=o()(c.a.mark((function e(u,l,d){var p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("createAsyncMiddleware"),console.log(u),function(){var e=o()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),(p={eth_requestAccounts:function(){var e=o()(c.a.mark((function e(){var t,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n(),r=t.activeAccount,l.result=[r.ethAddress];case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),eth_accounts:function(){var e=o()(c.a.mark((function e(){var t,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n(),r=t.activeAccount,l.result=[r.ethAddress];case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),eth_sendTransaction:function(){var e=o()(c.a.mark((function e(){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("eth_sendTransaction"),console.log(u),e.prev=2,e.next=5,t(u.params[0]);case 5:r=e.sent,l.result=r,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),l.error=e.t0.toString();case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),dekey_generateKey:function(){var e=o()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("dekey_generateKey"),console.log(u),e.prev=2,e.next=5,a(u.params[0],u.params[1]);case 5:l.result=!0,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0),l.error=e.t0.toString();case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}(),dekey_retrieveKey:function(){var e=o()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s(u.params[0],u.params[1]);case 3:l.result=!0,e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0),l.error=e.t0.toString();case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),dekey_unlock:function(){var e=o()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("dekey_unlock"),console.log(u),e.prev=2,e.next=5,i(u.params[0]);case 5:l.result=!0,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0),l.error=e.t0.toString();case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}(),dekey_resetDB:function(){var e=o()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("dekey_resetDB");try{r({}),l.result=!0}catch(e){console.error(e),l.error=e.toString()}case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),metamask_getProviderState:function(){var e=o()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("metamask_getProviderState called"),l.result={isUnlocked:!0,networkVersion:"1",chainId:"0x1",accounts:[]};case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),metamask_logWeb3ShimUsage:function(){return l.result=null}})[u.method]){e.next=7;break}return console.log("createAsyncMiddleware !rpcMethods[req.method]"),e.abrupt("return",d());case 7:return e.next=9,p[u.method]();case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())}({hostname:this.hostname,getProviderState:function(){},ethSendTransaction:this.transactionController.ethSendTransaction.bind(this.transactionController),resetStore:this.dekeyStore.reset.bind(this.dekeyStore),getStoreState:this.dekeyStore.getState.bind(this.dekeyStore),dekeyGenerateKey:this.accountController.generateKey.bind(this.accountController),retrieveKeyShare:this.accountController.retrieveKeyShare.bind(this.accountController),unlock:this.accountController.unlock.bind(this.accountController)})),console.log("before providerAsMiddleware"),console.log(n),t.push(Object(P.providerAsMiddleware)(n)),t}},{key:"sendNotification",value:function(e){console.log("sendNotification"),this.engine&&this.engine.emit("notification",e)}}]),r}(G),L=r(290),W=r.n(L),q=r(15),z=r.n(q),H=r(662);function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=k()(e);if(t){var o=k()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return g()(this,r)}}var X=1,Y=3,ee=4,te=5,re=42,ne=[{id:Object(H.a)(),name:"Ethereum Mainnet",rpcUrl:"https://eth-mainnet.alchemyapi.io/v2",chainId:X,target:"alchemy",isCustom:!1,symbol:"ETH",blockExplorerUrl:"https://etherscan.io",iconUrl:"./networks/eth.png"},{id:Object(H.a)(),name:"Rinkeby Testnet",rpcUrl:"https://rinkeby.infura.io/v3",chainId:ee,target:"infuraRinkeby",isCustom:!1,symbol:"ETH",blockExplorerUrl:"https://rinkeby.etherscan.io"},{id:Object(H.a)(),name:"Ropsten Testnet",rpcUrl:"https://ropsten.infura.io/v3",chainId:Y,target:"infuraRopsten",isCustom:!1,symbol:"ETH",blockExplorerUrl:"https://ropsten.etherscan.io"},{id:Object(H.a)(),name:"Kovan Testnet",rpcUrl:"https://kovan.infura.io/v3",chainId:re,target:"infuraKovan",isCustom:!1,symbol:"ETH",blockExplorerUrl:"https://kovan.etherscan.io"},{id:Object(H.a)(),name:"Goerli Testnet",rpcUrl:"https://goerli.infura.io/v3",chainId:te,target:"infuraGoerli",isCustom:!1,symbol:"ETH",blockExplorerUrl:"https://goerli.etherscan.io"}],oe=[{id:Object(H.a)(),name:"Eth",iconUrl:"https://assets.coingecko.com/coins/images/279/small/ethereum.png?1595348880",symbol:"ETH",decimal:18,balance:"0",formattedBalance:"0"}],ae=function(e){h()(r,e);var t=$(r);function r(e){var n,a=e.accountRestApi,s=e.keyCloudRestApi,i=e.dekeyStore;return l()(this,r),n=t.call(this),m()(p()(n),"registerUser",o()(c.a.mark((function e(){var t,r,o,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.accountRestApi.registerUser();case 3:return t=e.sent,r=t.mpcToken,o=t.accessToken,a=t.user,s=t.expiresIn,n.dekeyStore.updateStore({accessToken:o,expirationTime:(new Date).getTime()+ +s,mpcToken:r}),e.abrupt("return",{mpcToken:r,accessToken:o,user:a,expiresIn:s});case 12:throw e.prev=12,e.t0=e.catch(0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))),m()(p()(n),"saveKeygenResult",function(){var e=o()(c.a.mark((function e(t){var r,o,a,s,i,u,l,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("saveKeygenResult"),console.log(t),r=t.UCPubKey,o=t.OurPubKey,a=t.Sid,s=t.address,i=t.accessToken,u=t.PVEncStr,l=t.accountName,0,e.next=7,n.accountRestApi.saveKeyGenResult({uCPubKey:r,pubKey:o,sid:a,address:s,accessToken:i,accountId:0,accountName:l});case 7:(d=e.sent).share.EncPV=u,console.log("updatedUser"),console.log(d),n.dekeyStore.updateStore({user:d,activeAccount:d.share.accounts[0]}),e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}()),m()(p()(n),"initializeWallet",o()(c.a.mark((function e(){var t,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ne,r=oe[0],n.dekeyStore.updateStore({networks:W()(t),currentNetwork:t.find((function(e){return e.chainId===ee})),assets:[Z({},r)]});case 3:case"end":return e.stop()}}),e)})))),m()(p()(n),"saveShareToKeyCloud",function(){var e=o()(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.keyCloudRestApi.save(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m()(p()(n),"retreiveShareFromKeyCloud",function(){var e=o()(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.keyCloudRestApi.retrieve(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.accountRestApi=a,n.keyCloudRestApi=s,n.dekeyStore=i,n}return r}(z.a);function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=k()(e);if(t){var o=k()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return g()(this,r)}}var se=function(e){h()(r,e);var t=ce(r);function r(){var e;return l()(this,r),(e=t.call(this)).wasmEE=new z.a,e.uCWasm=new K(e.wasmEE),e.wasmEE.on("wasm:loaded",(function(t){e.emit("wasm:loaded")})),e}return i()(r,[{key:"generateKeyShare",value:function(e){var t=this;return new Promise((function(r,n){var o=new z.a;o.once("end",(function(e){e.success?r(e.data):n(e.message)})),t.uCWasm.generateKeyShare(e,o)}))}},{key:"sign",value:function(e){var t=this;return new Promise((function(r,n){var o=new z.a;o.once("end",(function(e){console.log("wasm event end"),console.log(e),e.success?r(e.data):n(e.message)})),t.uCWasm.sign(e,o)}))}},{key:"unlock",value:function(e){var t=this;return new Promise((function(r,n){var o=new z.a;o.once("end",(function(e){console.log("wasm event end"),console.log(e),e.success?r(e.data):n(e.message)})),t.uCWasm.unlock(e,o)}))}},{key:"changeActiveAccount",value:function(e){var t=this;return new Promise((function(r,n){var o=new z.a;o.once("end",(function(e){console.log("wasm event end"),console.log(e),e.success?r(e.data):n(e.message)})),t.uCWasm.changeActiveAccount(e,o)}))}}]),r}(z.a),ie=r(50);function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=k()(e);if(t){var o=k()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return g()(this,r)}}var le=function(e){h()(n,e);var t,r=ue(n);function n(e){var t,o=e.mpcService,a=e.dekeyStore;return l()(this,n),t=r.call(this),m()(p()(t),"calculateV",(function(e){var t=e.r,r=e.s,n=e.hash,o=e.addressInUse,a=e.vsource,c=e.chainId;try{var s=a+35+2*c;if(ie.a.utils.recoverAddress(n,{v:s,r:t,s:r})!==o)throw new Error("Recovered address is not equalt to addressInUse");return s}catch(e){throw e}})),m()(p()(t),"serializeEthTx",(function(e){return ie.a.utils.serializeTransaction(e)})),t.mpcService=o,t.dekeyStore=a,t}return i()(n,[{key:"signTx",value:(t=o()(c.a.mark((function e(t){var r,n,o,a,s,i,u,l,d,p,f,h,v,g,y,k;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.txParams,t.autoconfirm,n=t.network,o=t.nonce,a=t.account,t.dappInfo,t.ledgerService,e.prev=1,s=n.chainId,i=this.makeUnsignedTx({to:r.to,value:r.value,data:r.data,gasLimit:r.gasLimit,gasPrice:r.gasPrice,maxFeePerGas:r.maxFeePerGas,maxPriorityFeePerGas:r.maxPriorityFeePerGas,chainId:s,nonce:o}),r.contractAddress&&delete i.value,r.gasPrice,r.to,(u=this.dekeyStore.getState()).accessToken,l=u.mpcToken,console.log("before serializeEthTx"),console.log(i),d=this.serializeEthTx(i),console.log("before keccak"),p=ie.a.utils.keccak256(d),e.next=14,this.mpcService.sign({txHash:p.slice(2),mpcToken:l,accountId:a.aaid});case 14:if(f=e.sent,h=f.r,v=f.s,g=f.vsource,y=this.calculateV({r:h,s:v,vsource:g,hash:p,addressInUse:a.ethAddress,chainId:s}),k=ie.a.utils.serializeTransaction(i,{v:y,r:h,s:v})){e.next=20;break}throw new Error("no rawTx");case 20:return e.abrupt("return",k);case 23:throw e.prev=23,e.t0=e.catch(1),e.t0;case 26:case"end":return e.stop()}}),e,this,[[1,23]])}))),function(e){return t.apply(this,arguments)})},{key:"makeUnsignedTx",value:function(e){var t=e.to,r=e.value,n=e.data,o=e.gasLimit,a=e.gasPrice,c=e.maxFeePerGas,s=e.maxPriorityFeePerGas,i=e.chainId,u=e.nonce;return Boolean(c)?{chainId:i,data:n,to:t,value:r,nonce:u,gasLimit:o,maxFeePerGas:c,maxPriorityFeePerGas:s,type:2}:{chainId:i,data:n,to:t,value:r,nonce:u,gasLimit:o,gasPrice:a}}}]),n}(z.a),de=r(153),pe=r.n(de),fe=pe.a.create({baseURL:"".concat("https","://").concat("webwallet.dekey.app:9443","/api/"),timeout:1e4}),he=pe.a.create({baseURL:"".concat("http://63.250.52.190:31040"),timeout:1e4}),ve=function e(){l()(this,e),m()(this,"registerUser",o()(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("registerUser"),e.prev=1,e.next=4,fe.post("/v1/user/register");case 4:if(200!==(t=e.sent).status){e.next=7;break}return e.abrupt("return",t.data);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))),m()(this,"saveKeyGenResult",function(){var e=o()(c.a.mark((function e(t){var r,n,o,a,s,i,u,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("saveKeyGenResult"),console.log(t),e.prev=2,r=t.accessToken,n=t.address,o=t.pubKey,a=t.uCPubKey,s=t.sid,i=t.accountId,u=t.accountName,e.next=6,fe.post("/v1/address/add",{uCPubKey:a,pubkey:o,address:n,sid:s,accountId:i,accountName:u},{headers:{authorization:"Bearer "+r}});case 6:if(200===(l=e.sent).status&&!l.data.error){e.next=9;break}throw new Error(l.data.error);case 9:return e.abrupt("return",l.data.user);case 12:throw e.prev=12,e.t0=e.catch(2),e.t0;case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}()),m()(this,"getMpcJwt",function(){var e=o()(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe.post("/v1/address/auth/gen",{},{headers:{authorization:"Bearer "+t}});case 3:if(200===(r=e.sent).status){e.next=6;break}throw new Error("get mpc error");case 6:return e.abrupt("return",r.data.mpcJwt);case 9:throw e.prev=9,e.t0=e.catch(0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}())},ge=function e(){l()(this,e),m()(this,"save",function(){var e=o()(c.a.mark((function e(t){var r,n,o,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.userid,n=t.passwordhash,o=t.encshare,e.prev=1,console.log("KeyCloudRestApi save"),console.log(o),e.next=6,he.post("/save",{userid:r,passwordhash:n,encshare:o});case 6:if(200===(a=e.sent).status&&(!a.data||a.data.saved)){e.next=9;break}throw new Error(a.data.errstring);case 9:return console.log("KeyCloudRestApi res"),console.log(a.data),e.abrupt("return",a.data);case 14:throw e.prev=14,e.t0=e.catch(1),e.t0;case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}()),m()(this,"retrieve",function(){var e=o()(c.a.mark((function e(t){var r,n,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.userid,n=t.passwordhash,e.prev=1,console.log("KeyCloudRestApi retrieve"),e.next=5,he.post("/retrieve",{userid:r,passwordhash:n});case 5:if(200===(o=e.sent).status&&o.data.encshare&&!o.data.errstring){e.next=8;break}throw new Error(o.data.errstring);case 8:return e.abrupt("return",o.data.encshare);case 11:throw e.prev=11,e.t0=e.catch(1),e.t0;case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}())},ye=r(148),ke=r.n(ye);function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var be=function(){function e(){l()(this,e)}return i()(e,[{key:"reset",value:function(){localStorage.removeItem("dekey")}},{key:"getState",value:function(){try{var e,t=localStorage.getItem("dekey");return console.log("getState"),console.log(JSON.stringify(t)),console.log(t),console.log(ke()(t)),null!==(e=JSON.parse(t))&&void 0!==e?e:{}}catch(e){return{}}}},{key:"updateStore",value:function(e){var t={};try{t=JSON.parse(localStorage.getItem("dekey"))}catch(e){}var r=me(me({},t),e);console.log("updateStore"),console.dir(r),localStorage.setItem("dekey",JSON.stringify(r))}}]),e}(),Se=r(293),xe=r.n(Se),Pe=r(26),Oe=r(294),Ee=r.n(Oe),Te=r(154),_e=r(295);function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function je(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ce={pollingInterval:1e4};function Me(e){return function(t,r,n,o){return"eth_chainId"===t.method?(r.result=e,o()):n()}}function Ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=k()(e);if(t){var o=k()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return g()(this,r)}}var Ie=function(e){h()(s,e);var t,r,n,a=Ae(s);function s(){var e;l()(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e=a.call.apply(a,[this].concat(r)),m()(p()(e),"connection",void 0),m()(p()(e),"query",void 0),m()(p()(e),"ethQuery",void 0),m()(p()(e),"ethersProvider",void 0),m()(p()(e),"dekeyStore",void 0),m()(p()(e),"connected",void 0),m()(p()(e),"web3",void 0),m()(p()(e),"chainId",void 0),m()(p()(e),"_providerProxy",void 0),m()(p()(e),"_blockTrackerProxy",void 0),m()(p()(e),"_provider",void 0),m()(p()(e),"_blockTracker",void 0),e}return i()(s,[{key:"getProviderAndBlockTracker",value:function(){return console.log("getProviderAndBlockTracker"),console.log(this._providerProxy),console.log(this._blockTrackerProxy),console.log(this._provider),console.log(this._blockTracker),{provider:this._providerProxy,blockTracker:this._blockTrackerProxy}}},{key:"connect",value:(n=o()(c.a.mark((function e(t,r){var n,o,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("providerConnectionManager connect"),e.prev=1,n=t.chainId,o=t.rpcUrl,t.target,t.isCustom,a=o.replace(/\/$/,""),s=o.includes("infura")?a+"/".concat("b75afa66ea2643a682e7905f8c67e5d5"):o.includes("alchemy")?a+"/".concat("DZKo8RxBfsG03OUaDo9fiSZw_Q8NuOsS"):a,this._initialize({rpcUrl:s,chainId:n}),this.web3=new xe.a(this._provider),this.ethersProvider=new ie.a.providers.Web3Provider(this._provider),this.query=new Ee.a(this._provider),this.chainId=t.chainId,e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(1),e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e,t){return n.apply(this,arguments)})},{key:"_initialize",value:function(e){var t=function(e){var t=e.rpcUrl,r=e.chainId,n=Object(P.createFetchMiddleware)({rpcUrl:t}),o=Object(P.providerFromMiddleware)(n),a=new _e.PollingBlockTracker(je(je({},Ce),{},{provider:o}));return{networkMiddleware:Object(x.mergeMiddleware)([Me(r),n]),blockTracker:a}}({rpcUrl:e.rpcUrl,chainId:e.chainId,networkDomain:e.networkDomain});this._setNetworkClient(t)}},{key:"_setNetworkClient",value:function(e){var t=e.networkMiddleware,r=e.blockTracker,n=new x.JsonRpcEngine;n.push(t);var o=Object(P.providerFromEngine)(n);console.log("_setNetworkClient"),console.log(o),this._setProviderAndBlockTracker({provider:o,blockTracker:r}),console.log("after _setProviderAndBlockTracker"),console.log({_provider:this._provider,_blockTracker:this._blockTracker})}},{key:"_setProviderAndBlockTracker",value:function(e){var t=e.provider,r=e.blockTracker;this._providerProxy?this._providerProxy.setTarget(t):this._providerProxy=Object(Te.createSwappableProxy)(t),this._blockTrackerProxy?this._blockTrackerProxy.setTarget(r):this._blockTrackerProxy=Object(Te.createEventEmitterProxy)(r,{eventFilter:"skipInternal"}),this._provider=t,this._blockTracker=r}},{key:"getTransactionCount",value:(r=o()(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.query.getTransactionCount(t,"pending");case 2:return r=e.sent,e.abrupt("return",Pe.a.from(r.toString(10)).toHexString());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"broadcastTx",value:(t=o()(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.query.sendRawTransaction(t);case 2:return r=e.sent,console.log("broadcastTx result"),console.log(r),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),s}(z.a),Ke=function(){function e(t){var r=t.transactionService,n=t.providerConnectionManager,o=t.dekeyStore;l()(this,e),this.transactionService=r,this.providerConnectionManager=n,this.dekeyStore=o}var t;return i()(e,[{key:"ethSendTransaction",value:(t=o()(c.a.mark((function e(t){var r,n,o,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("ethSendTransaction newTxParams"),console.log(t),r=this.dekeyStore.getState(),n=r.activeAccount,o=r.currentNetwork,e.next=5,this.providerConnectionManager.getTransactionCount(n.ethAddress);case 5:return a=e.sent,e.next=8,this.transactionService.signTx({txParams:{chainId:o.chainId,data:"0x69318a7900000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000",from:n.ethAddress,to:"0x31D9BC105a7eE27c7b78Ba3758Cf7B5D79ccA06E",gasLimit:"0xdd63",maxFeePerGas:"0x3b9aca16",maxPriorityFeePerGas:"0x3b9aca00"},nonce:a,network:o,account:n});case 8:return s=e.sent,console.log("rawTx: ".concat(s)),e.abrupt("return",this.providerConnectionManager.broadcastTx(s));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();r(657);function Be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(r),!0).forEach((function(t){m()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var De=function(){function e(t){var r=t.accountService,n=t.mpcService,o=t.dekeyStore;l()(this,e),this.accountService=r,this.mpcService=n,this.dekeyStore=o}var t,r,n;return i()(e,[{key:"generateKey",value:(n=o()(c.a.mark((function e(t,r){var n,o,a,s,i,u,l,d,p,f,h,v,g,y;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("generateKey"),console.log(t),n="Account 1",e.next=5,this.accountService.registerUser();case 5:return o=e.sent,console.log("registerUserResult"),console.log(o),a=o.mpcToken,s=o.accessToken,o.expiresIn,e.next=11,this.mpcService.generateKeyShare({uid:o.user.uid,wid:o.user.wid,password:t,mpcToken:a});case 11:return i=e.sent,console.log("mpc keyGenResult"),console.log(i),i=Ue(Ue({},i),{},{accountName:n}),l=(u=i).UCPubKey,d=u.OurPubKey,p=u.Sid,f=u.EthAddress,h=u.PVEncStr,v=u.accountName,e.next=18,this.accountService.saveKeygenResult({UCPubKey:l,OurPubKey:d,Sid:p,address:f,accessToken:s,PVEncStr:h,accountName:v});case 18:return g=this.dekeyStore.getState(),y=t,e.next=22,this.accountService.saveShareToKeyCloud({userid:r,passwordhash:y,encshare:JSON.stringify(g)});case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"unlock",value:(r=o()(c.a.mark((function e(t){var r,n,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("account controller unlock"),console.log(t),e.prev=2,r=this.dekeyStore.getState(),n=r.user,o=r.activeAccount,e.next=6,this.mpcService.unlock({EncPV:n.share.EncPV,password:t,hashMessage:""});case 6:return e.next=8,this.mpcService.changeActiveAccount({accountId:o.aaid});case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(2),e.t0;case 13:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(e){return r.apply(this,arguments)})},{key:"retrieveKeyShare",value:(t=o()(c.a.mark((function e(t,r){var n,o,a,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("account controller retrieveKeyShare"),console.log(t,r),e.prev=2,n=t,e.next=6,this.accountService.retreiveShareFromKeyCloud({passwordhash:n,userid:r});case 6:return o=e.sent,a=JSON.parse(o),this.dekeyStore.updateStore(a),s=a.user,i=a.activeAccount,e.next=12,this.mpcService.unlock({EncPV:s.share.EncPV,password:t,hashMessage:""});case 12:return e.next=14,this.mpcService.changeActiveAccount({accountId:i.aaid});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(2),e.t0;case 19:case"end":return e.stop()}}),e,this,[[2,16]])}))),function(e,r){return t.apply(this,arguments)})}]),e}();console.log("start background wrapper");o()(c.a.mark((function e(){var t,r,n,a,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new be,r=new ve,n=new ge,a=new ae({accountRestApi:r,keyCloudRestApi:n,dekeyStore:t}),s=new se,i=new le({mpcService:s,dekeyStore:t}),s.on("wasm:loaded",o()(c.a.mark((function e(){var r,n,o,u,l,d,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.getState(),console.log("existingState"),console.log(r),n=r.user,n&&n.share&&n.share.EncPV,r.currentNetwork&&r.assets&&r.networks){e.next=9;break}return e.next=9,a.initializeWallet();case 9:return o=t.getState(),u=o.currentNetwork,l=new Ie,d=new Ke({transactionService:i,providerConnectionManager:l,dekeyStore:t}),p=new De({accountService:a,mpcService:s,dekeyStore:t}),e.next=15,l.connect(u);case 15:new J({webview:window,url:window.location.href,isMainFrame:!0,transactionController:d,accountController:p,providerConnectionManager:l,dekeyStore:t});case 16:case"end":return e.stop()}}),e)}))));case 7:case"end":return e.stop()}}),e)})))()}});